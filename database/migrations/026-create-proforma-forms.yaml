databaseChangeLog:
  - changeSet:
      id: 026-create-proforma-forms-tables
      author: system
      changes:
        # ProForma Forms - Advanced Forms for Jira

        # Forms
        - createTable:
            tableName: ao_b4a6a2_form
            columns:
              - column:
                  name: id
                  type: BIGSERIAL
                  constraints:
                    primaryKey: true
              - column:
                  name: form_uuid
                  type: VARCHAR(255)
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: form_name
                  type: VARCHAR(500)
                  constraints:
                    nullable: false
              - column:
                  name: description
                  type: TEXT
              - column:
                  name: project_id
                  type: BIGINT
              - column:
                  name: issue_type_id
                  type: BIGINT
              - column:
                  name: created_by
                  type: VARCHAR(255)
              - column:
                  name: created_date
                  type: TIMESTAMP
                  defaultValueComputed: CURRENT_TIMESTAMP
              - column:
                  name: updated_date
                  type: TIMESTAMP
              - column:
                  name: is_active
                  type: BOOLEAN
                  defaultValueBoolean: true
              - column:
                  name: is_template
                  type: BOOLEAN
                  defaultValueBoolean: false

        # Form Versions
        - createTable:
            tableName: ao_b4a6a2_form_version
            columns:
              - column:
                  name: id
                  type: BIGSERIAL
                  constraints:
                    primaryKey: true
              - column:
                  name: form_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: version_number
                  type: INTEGER
                  constraints:
                    nullable: false
              - column:
                  name: version_uuid
                  type: VARCHAR(255)
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: form_definition
                  type: TEXT
              - column:
                  name: created_by
                  type: VARCHAR(255)
              - column:
                  name: created_date
                  type: TIMESTAMP
                  defaultValueComputed: CURRENT_TIMESTAMP
              - column:
                  name: is_published
                  type: BOOLEAN
                  defaultValueBoolean: false

        # Form Questions
        - createTable:
            tableName: ao_b4a6a2_form_question
            columns:
              - column:
                  name: id
                  type: BIGSERIAL
                  constraints:
                    primaryKey: true
              - column:
                  name: form_version_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: question_uuid
                  type: VARCHAR(255)
                  constraints:
                    nullable: false
              - column:
                  name: question_text
                  type: TEXT
                  constraints:
                    nullable: false
              - column:
                  name: question_type
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
              - column:
                  name: help_text
                  type: TEXT
              - column:
                  name: is_required
                  type: BOOLEAN
                  defaultValueBoolean: false
              - column:
                  name: order_index
                  type: INTEGER
              - column:
                  name: parent_question_id
                  type: BIGINT
              - column:
                  name: section_id
                  type: BIGINT

        # Form Sections
        - createTable:
            tableName: ao_b4a6a2_form_section
            columns:
              - column:
                  name: id
                  type: BIGSERIAL
                  constraints:
                    primaryKey: true
              - column:
                  name: form_version_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: section_uuid
                  type: VARCHAR(255)
                  constraints:
                    nullable: false
              - column:
                  name: section_name
                  type: VARCHAR(500)
              - column:
                  name: description
                  type: TEXT
              - column:
                  name: order_index
                  type: INTEGER
              - column:
                  name: is_collapsible
                  type: BOOLEAN
                  defaultValueBoolean: false
              - column:
                  name: is_collapsed
                  type: BOOLEAN
                  defaultValueBoolean: false

        # Question Choices
        - createTable:
            tableName: ao_b4a6a2_question_choice
            columns:
              - column:
                  name: id
                  type: BIGSERIAL
                  constraints:
                    primaryKey: true
              - column:
                  name: question_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: choice_uuid
                  type: VARCHAR(255)
                  constraints:
                    nullable: false
              - column:
                  name: choice_text
                  type: TEXT
                  constraints:
                    nullable: false
              - column:
                  name: choice_value
                  type: VARCHAR(500)
              - column:
                  name: order_index
                  type: INTEGER
              - column:
                  name: is_default
                  type: BOOLEAN
                  defaultValueBoolean: false

        # Form Answers (Responses)
        - createTable:
            tableName: ao_b4a6a2_form_answer
            columns:
              - column:
                  name: id
                  type: BIGSERIAL
                  constraints:
                    primaryKey: true
              - column:
                  name: form_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: form_version_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: issue_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: submitted_by
                  type: VARCHAR(255)
              - column:
                  name: submitted_date
                  type: TIMESTAMP
                  defaultValueComputed: CURRENT_TIMESTAMP
              - column:
                  name: updated_date
                  type: TIMESTAMP
              - column:
                  name: is_complete
                  type: BOOLEAN
                  defaultValueBoolean: false

        # Question Answers
        - createTable:
            tableName: ao_b4a6a2_question_answer
            columns:
              - column:
                  name: id
                  type: BIGSERIAL
                  constraints:
                    primaryKey: true
              - column:
                  name: form_answer_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: question_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: question_uuid
                  type: VARCHAR(255)
              - column:
                  name: answer_text
                  type: TEXT
              - column:
                  name: answer_value
                  type: TEXT
              - column:
                  name: choice_id
                  type: BIGINT
              - column:
                  name: updated_date
                  type: TIMESTAMP

        # Form Rules
        - createTable:
            tableName: ao_b4a6a2_form_rule
            columns:
              - column:
                  name: id
                  type: BIGSERIAL
                  constraints:
                    primaryKey: true
              - column:
                  name: form_version_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: rule_uuid
                  type: VARCHAR(255)
                  constraints:
                    nullable: false
              - column:
                  name: rule_name
                  type: VARCHAR(500)
              - column:
                  name: rule_type
                  type: VARCHAR(100)
              - column:
                  name: condition
                  type: TEXT
              - column:
                  name: action
                  type: TEXT
              - column:
                  name: is_active
                  type: BOOLEAN
                  defaultValueBoolean: true

        # Form Validation Rules
        - createTable:
            tableName: ao_b4a6a2_validation_rule
            columns:
              - column:
                  name: id
                  type: BIGSERIAL
                  constraints:
                    primaryKey: true
              - column:
                  name: question_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: validation_type
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
              - column:
                  name: validation_config
                  type: TEXT
              - column:
                  name: error_message
                  type: TEXT

        # Form Templates
        - createTable:
            tableName: ao_b4a6a2_form_template
            columns:
              - column:
                  name: id
                  type: BIGSERIAL
                  constraints:
                    primaryKey: true
              - column:
                  name: template_uuid
                  type: VARCHAR(255)
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: template_name
                  type: VARCHAR(500)
                  constraints:
                    nullable: false
              - column:
                  name: description
                  type: TEXT
              - column:
                  name: category
                  type: VARCHAR(255)
              - column:
                  name: template_data
                  type: TEXT
              - column:
                  name: is_global
                  type: BOOLEAN
                  defaultValueBoolean: false
              - column:
                  name: created_by
                  type: VARCHAR(255)
              - column:
                  name: created_date
                  type: TIMESTAMP
                  defaultValueComputed: CURRENT_TIMESTAMP

        # Form Permissions
        - createTable:
            tableName: ao_b4a6a2_form_permission
            columns:
              - column:
                  name: id
                  type: BIGSERIAL
                  constraints:
                    primaryKey: true
              - column:
                  name: form_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: permission_type
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
              - column:
                  name: user_key
                  type: VARCHAR(255)
              - column:
                  name: group_name
                  type: VARCHAR(255)
              - column:
                  name: role_id
                  type: BIGINT

        # Form Workflow Mappings
        - createTable:
            tableName: ao_b4a6a2_workflow_mapping
            columns:
              - column:
                  name: id
                  type: BIGSERIAL
                  constraints:
                    primaryKey: true
              - column:
                  name: form_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: workflow_id
                  type: BIGINT
              - column:
                  name: transition_id
                  type: BIGINT
              - column:
                  name: screen_id
                  type: BIGINT
              - column:
                  name: mapping_type
                  type: VARCHAR(100)

        # Form Calculations
        - createTable:
            tableName: ao_b4a6a2_form_calculation
            columns:
              - column:
                  name: id
                  type: BIGSERIAL
                  constraints:
                    primaryKey: true
              - column:
                  name: form_version_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: calculation_uuid
                  type: VARCHAR(255)
                  constraints:
                    nullable: false
              - column:
                  name: calculation_name
                  type: VARCHAR(500)
              - column:
                  name: formula
                  type: TEXT
              - column:
                  name: target_question_id
                  type: BIGINT

        # Form Attachments
        - createTable:
            tableName: ao_b4a6a2_form_attachment
            columns:
              - column:
                  name: id
                  type: BIGSERIAL
                  constraints:
                    primaryKey: true
              - column:
                  name: question_answer_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: file_name
                  type: VARCHAR(500)
              - column:
                  name: file_size
                  type: BIGINT
              - column:
                  name: mime_type
                  type: VARCHAR(255)
              - column:
                  name: uploaded_by
                  type: VARCHAR(255)
              - column:
                  name: uploaded_date
                  type: TIMESTAMP
                  defaultValueComputed: CURRENT_TIMESTAMP

        # Form Conditions
        - createTable:
            tableName: ao_b4a6a2_form_condition
            columns:
              - column:
                  name: id
                  type: BIGSERIAL
                  constraints:
                    primaryKey: true
              - column:
                  name: question_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: condition_type
                  type: VARCHAR(100)
              - column:
                  name: source_question_id
                  type: BIGINT
              - column:
                  name: operator
                  type: VARCHAR(50)
              - column:
                  name: value
                  type: TEXT

        # Form Audit Log
        - createTable:
            tableName: ao_b4a6a2_form_audit
            columns:
              - column:
                  name: id
                  type: BIGSERIAL
                  constraints:
                    primaryKey: true
              - column:
                  name: form_id
                  type: BIGINT
              - column:
                  name: form_answer_id
                  type: BIGINT
              - column:
                  name: action_type
                  type: VARCHAR(100)
              - column:
                  name: user_key
                  type: VARCHAR(255)
              - column:
                  name: action_date
                  type: TIMESTAMP
                  defaultValueComputed: CURRENT_TIMESTAMP
              - column:
                  name: old_value
                  type: TEXT
              - column:
                  name: new_value
                  type: TEXT

        # Form Reports
        - createTable:
            tableName: ao_b4a6a2_form_report
            columns:
              - column:
                  name: id
                  type: BIGSERIAL
                  constraints:
                    primaryKey: true
              - column:
                  name: report_uuid
                  type: VARCHAR(255)
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: report_name
                  type: VARCHAR(500)
              - column:
                  name: form_id
                  type: BIGINT
              - column:
                  name: report_type
                  type: VARCHAR(100)
              - column:
                  name: report_config
                  type: TEXT
              - column:
                  name: created_by
                  type: VARCHAR(255)
              - column:
                  name: created_date
                  type: TIMESTAMP
                  defaultValueComputed: CURRENT_TIMESTAMP

        # Form Notifications
        - createTable:
            tableName: ao_b4a6a2_form_notification
            columns:
              - column:
                  name: id
                  type: BIGSERIAL
                  constraints:
                    primaryKey: true
              - column:
                  name: form_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: notification_type
                  type: VARCHAR(100)
              - column:
                  name: trigger_event
                  type: VARCHAR(100)
              - column:
                  name: recipient_type
                  type: VARCHAR(100)
              - column:
                  name: recipient_value
                  type: TEXT
              - column:
                  name: message_template
                  type: TEXT
              - column:
                  name: is_active
                  type: BOOLEAN
                  defaultValueBoolean: true

        # Form Signatures
        - createTable:
            tableName: ao_b4a6a2_form_signature
            columns:
              - column:
                  name: id
                  type: BIGSERIAL
                  constraints:
                    primaryKey: true
              - column:
                  name: form_answer_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: question_id
                  type: BIGINT
              - column:
                  name: signature_data
                  type: TEXT
              - column:
                  name: signed_by
                  type: VARCHAR(255)
              - column:
                  name: signed_date
                  type: TIMESTAMP
              - column:
                  name: ip_address
                  type: VARCHAR(100)

        # Form Settings
        - createTable:
            tableName: ao_b4a6a2_form_setting
            columns:
              - column:
                  name: id
                  type: BIGSERIAL
                  constraints:
                    primaryKey: true
              - column:
                  name: form_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: setting_key
                  type: VARCHAR(255)
                  constraints:
                    nullable: false
              - column:
                  name: setting_value
                  type: TEXT

        # Form Export Configurations
        - createTable:
            tableName: ao_b4a6a2_export_config
            columns:
              - column:
                  name: id
                  type: BIGSERIAL
                  constraints:
                    primaryKey: true
              - column:
                  name: config_uuid
                  type: VARCHAR(255)
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: config_name
                  type: VARCHAR(500)
              - column:
                  name: form_id
                  type: BIGINT
              - column:
                  name: export_format
                  type: VARCHAR(100)
              - column:
                  name: export_config
                  type: TEXT
              - column:
                  name: created_by
                  type: VARCHAR(255)

        # Form Analytics
        - createTable:
            tableName: ao_b4a6a2_form_analytics
            columns:
              - column:
                  name: id
                  type: BIGSERIAL
                  constraints:
                    primaryKey: true
              - column:
                  name: form_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: analytics_date
                  type: DATE
              - column:
                  name: total_submissions
                  type: INTEGER
              - column:
                  name: completed_submissions
                  type: INTEGER
              - column:
                  name: incomplete_submissions
                  type: INTEGER
              - column:
                  name: avg_completion_time
                  type: INTEGER

        # Form User Preferences
        - createTable:
            tableName: ao_b4a6a2_user_preference
            columns:
              - column:
                  name: id
                  type: BIGSERIAL
                  constraints:
                    primaryKey: true
              - column:
                  name: user_key
                  type: VARCHAR(255)
                  constraints:
                    nullable: false
              - column:
                  name: form_id
                  type: BIGINT
              - column:
                  name: preference_key
                  type: VARCHAR(255)
              - column:
                  name: preference_value
                  type: TEXT
